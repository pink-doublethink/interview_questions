---
tags:
- Technology/BA
- Difficulty/Intermediate
---
----
## Как вы проектируете систему на событиях и какие гарантии доставки используете
----
> [!FAQ]- Ответ
> - При проектировании событийно-ориентированной системы я начинаю с проведения семинаров по Event Storming с ключевыми заинтересованными сторонами, чтобы определить критически важные доменные события, которые обеспечивают бизнес-ценность. Это позволяет нам составить карту производителей — систем, генерирующих данные, — и потребителей, которые должны реагировать на эти изменения состояния, обеспечивая соблюдение принципов предметно-ориентированного проектирования (DDD). На этом этапе мое основное внимание сосредоточено на определении контрактов данных и структур полезной нагрузки (часто с использованием схем JSON или Avro) для обеспечения слабой связанности между сервисами. Я документирую эти асинхронные потоки с помощью диаграмм последовательности и функциональных спецификаций, которые подробно описывают, как модель публикации-подписки поддерживает необходимую масштабируемость и реагирование в реальном времени, требуемые бизнес-сценарием.
> - Что касается гарантий доставки, я определяю соответствующую стратегию, анализируя конкретные нефункциональные требования (NFR), связанные с согласованностью данных и задержкой системы. Для менее критичных данных, таких как анализ потока кликов, где допустима случайная потеря данных в обмен на высокую пропускную способность, я могу указать гарантию доставки «не более одного раза». Однако для критически важных бизнес-операций, таких как финансовые транзакции или управление запасами, я почти всегда требую доставки «как минимум один раз», чтобы гарантировать, что ни одно событие не будет потеряно в случае сбоя сети или отказа брокера. Поскольку доставка «как минимум один раз» создает риск дублирования сообщений, я тщательно определяю требования к идемпотентности потребителя, гарантируя, что нижестоящие системы могут обрабатывать повторную обработку одного и того же уникального идентификатора события без повреждения состояния базы данных.
> - Наконец, для обеспечения отказоустойчивости системы и эффективного мониторинга я включаю требования к обработке ошибок и очередям недоставленных сообщений (DLQ). Это включает в себя определение политик повторных попыток — таких как экспоненциальная задержка — и определение критериев, по которым неудачное сообщение перемещается в DLQ для ручного анализа. Устанавливая эти режимы сбоев и пороговые значения оповещений заранее, я гарантирую, что операционная группа имеет необходимую информацию о состоянии брокера сообщений, независимо от того, используем ли мы такие инструменты, как Apache Kafka или AWS SNS/SQS. Этот комплексный подход гарантирует, что архитектура не только удовлетворяет непосредственные функциональные потребности, но и обеспечивает надежность и отслеживаемость, необходимые для надежного корпоративного решения.