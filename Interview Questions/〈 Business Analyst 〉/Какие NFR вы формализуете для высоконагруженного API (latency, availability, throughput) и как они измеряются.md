---
tags:
- Technology/BA
- Difficulty/Intermediate
---
----
## Какие NFR вы формализуете для высоконагруженного API (latency, availability, throughput) и как они измеряются
----
> [!FAQ]- Ответ
> - Я бы рекомендовал внедрять секционирование таблиц прежде всего в случаях работы с крупномасштабными наборами данных — часто превышающими сотни гигабайт — где производительность запросов снижается из-за чрезмерных операций ввода-вывода или где управление жизненным циклом данных становится операционно обременительным. Выбор стратегии секционирования полностью зависит от бизнес-логики и шаблонов доступа: я бы выбрал секционирование по диапазону для временных рядов, таких как финансовые отчеты, где пользователи часто выполняют запросы по финансовым кварталам; секционирование по списку для данных с четкими категориальными границами, такими как географические регионы или конкретные линейки продуктов; и хеш-секционирование для равномерного распределения данных по системам хранения, чтобы предотвратить «горячие точки» при отсутствии логической бизнес-группировки. Изолируя данные в управляемые сегменты, мы гарантируем, что задачи обслуживания, такие как архивирование исторических записей или перестроение индексов, могут выполняться на отдельных разделах без блокировки всей таблицы, тем самым удовлетворяя требованиям высокой доступности.
> - Влияние этой структуры на планы выполнения запросов лучше всего иллюстрируется концепцией отсечения разделов (или исключения разделов). Когда пользователь выполняет запрос с предложением WHERE, которое нацелено на ключ секционирования — например, фильтрация транзакций за «январь 2024 года» — оптимизатор базы данных понимает, что ему необходимо получить доступ только к конкретному разделу, содержащему этот диапазон дат. В плане выполнения вы увидите переход от дорогостоящего «полного сканирования таблицы» к высокоэффективному «сканированию диапазона разделов». Эта оптимизация значительно сокращает количество страниц данных, которые должен прочитать движок, снижая нагрузку на ЦП и операции ввода-вывода. Однако крайне важно отметить, что если запрос не фильтруется по ключу секционирования, оптимизатор может быть вынужден сканировать все разделы, что потенциально может привести к производительности не лучше, а иногда и хуже, чем у несекционированной таблицы. Поэтому я всегда слежу за тем, чтобы наши требования к отчетности и наиболее частые предикаты запросов соответствовали выбранному ключу секционирования на этапе проектирования.
> - Наконец, решение о секционировании также требует стратегического анализа индексирования, в частности, выбора между глобальными и локальными секционированными индексами, что дополнительно влияет на план выполнения. Локальный индекс соответствует разделам один к одному, что упрощает обслуживание (например, удаление раздела приводит к удалению его сегмента индекса), но требует, чтобы запрос включал ключ секционирования, чтобы избежать сканирования каждого сегмента локального индекса. Напротив, глобальный индекс охватывает всю таблицу и может ускорить запросы, которые не используют ключ секционирования, но он создает значительные накладные расходы при выполнении операций обслуживания разделов. В качестве бизнес-аналитика я тесно сотрудничаю с архитекторами данных, чтобы сопоставлять эти компромиссы с нашими соглашениями об уровне обслуживания (SLA) в отношении задержки при формировании отчетов и периодов технического обслуживания, гарантируя, что техническая реализация поддерживает фактическое использование в бизнесе, а не только теоретические лучшие практики.