---
tags:
- Technology/BA
- Difficulty/Intermediate
---
----
## Как вы выбираете между CHAR и VARCHAR при проектировании схемы БД с учётом хранения, индексации и частоты обновлений
----
> [!FAQ]- Ответ
> - При оценке целесообразности использования типов данных CHAR или VARCHAR на этапе логического моделирования данных и проектирования схемы я в первую очередь анализирую предсказуемость и согласованность атрибутов данных, определенных в функциональных требованиях. Я выступаю за использование CHAR для данных фиксированной длины, где количество символов строго неизменно, например, для кодов стран ISO, сокращений названий штатов или криптографических хешей фиксированной длины. Это связано с тем, что CHAR резервирует статическое количество места на диске независимо от фактического ввода, заполняя оставшееся пространство пробелами. И наоборот, я выбираю VARCHAR для атрибутов переменной длины, таких как имена клиентов, адреса электронной почты или описания продуктов. С точки зрения эффективности хранения, VARCHAR имеет решающее значение для этих разнородных наборов данных; он предотвращает нерациональное использование дискового пространства, потребляя только байты, необходимые для фактических данных, плюс минимальные накладные расходы на информацию о длине, что важно для оптимизации затрат на хранение в крупномасштабных хранилищах данных.
> - Что касается производительности индексирования и извлечения данных, мое решение напрямую связано с требованиями к пропускной способности ввода-вывода системы. Исторически сложилось так, что CHAR обеспечивал преимущество в производительности, поскольку фиксированная ширина позволяла механизму базы данных более эффективно с точки зрения вычислительных ресурсов вычислять точное смещение следующей записи в памяти. Однако в современных механизмах баз данных это преимущество в обработке часто незначительно по сравнению с преимуществами ввода-вывода, позволяющими разместить больше записей на одной странице данных. Поэтому, если использование CHAR приводит к значительному заполнению пробелами, что снижает плотность страниц данных в буферном пуле, я предпочитаю VARCHAR. Сохраняя записи компактными, мы улучшаем коэффициент попадания в кэш, обеспечивая оптимальную производительность сканирования индексов и запросов диапазона за счет минимизации количества операций чтения с диска, необходимых для получения результирующего набора.
> - Наконец, частота обновлений и потенциальная миграция строк являются решающими факторами в моих технических спецификациях. Если столбец требует частых обновлений, при которых изменяется длина данных — например, поле статуса, которое может меняться с «Ожидание» на «Утверждено» — использование VARCHAR может привести к фрагментации. Если обновленное значение превышает исходную длину, а на текущей странице данных недостаточно места, механизм базы данных должен переместить запись или разделить страницу, что приводит к снижению производительности. CHAR устраняет этот конкретный риск фрагментации, поскольку объем занимаемого места остается постоянным независимо от изменения значения. Следовательно, для столбцов с высокой частотой обновлений, где целостность данных и стабильная производительность записи имеют первостепенное значение, я склоняюсь к CHAR, чтобы предотвратить миграцию строк, тогда как VARCHAR остается стандартом для описательных полей, где основной целью является оптимизация хранения, а не стабильность скорости записи.