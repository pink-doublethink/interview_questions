---
tags:
- Technology
- Difficulty/Base
---
----
## Брокеры сообщений и устройство Kafka
----
> [!FAQ]- Ответ
> - Apache Kafka лучше всего понимать не просто как традиционный брокер сообщений, а как распределенную платформу потоковой обработки событий, обеспечивающую высокую пропускную способность и низкую задержку в конвейерах обработки данных. С точки зрения системного анализа, она принципиально работает по модели публикации-подписки, но существенно отличается от таких очередей, как RabbitMQ или ActiveMQ, благодаря своей архитектуре хранения данных. В стандартной конфигурации приложения, выступающие в роли отправителей, передают данные (события) в отдельные категории, известные как темы. Эти темы разделяются на разделы и реплицируются по кластеру серверов, или брокеров, что обеспечивает масштабируемость и отказоустойчивость. В отличие от традиционных очередей, которые обычно удаляют сообщения после их обработки, Kafka действует как распределенный журнал транзакций, сохраняя записи на диске в течение настраиваемого периода хранения, независимо от того, были ли они обработаны.
> - Механизмы потребления данных в Kafka особенно важны при определении нефункциональных требований к согласованности данных и масштабируемости. Внутри темы данные разделяются на разделы, которые представляют собой упорядоченные, неизменяемые последовательности записей. Потребители — приложения, считывающие данные, — подписываются на эти темы и извлекают данные в своем собственном темпе. Важно отметить, что потребитель отвечает за отслеживание своей позиции в журнале с помощью уникального идентификатора, называемого смещением. Этот архитектурный выбор снимает с брокера нагрузку по отслеживанию состояния потребителя, позволяя Kafka одновременно обрабатывать огромные объемы операций чтения и записи. Это также позволяет нескольким группам потребителей независимо обрабатывать один и тот же поток данных; например, один сервис может обрабатывать журналы транзакций для обнаружения мошенничества в режиме реального времени, в то время как другой одновременно обрабатывает те же самые журналы для долгосрочного хранения, при этом ни один из процессов не влияет на производительность другого.
> - В практическом бизнес-контексте понимание этой архитектуры жизненно важно для проектирования слабосвязанных систем. Внедрение Kafka в качестве промежуточного слоя позволяет отделить отправителей от потребителей, что означает, что вышестоящей системе не нужно знать, кто потребляет данные, или ждать подтверждения обработки. В моей предыдущей работе, связанной с миграцией устаревшей системы, мы использовали это для того, чтобы всплеск активности пользователей не перегружал наши внутренние системы управления запасами; Kafka буферизовала запросы, позволяя сервису управления запасами обрабатывать обновления с приемлемой скоростью. Такой подход не только повысил отказоустойчивость системы, но и упростил логику интеграции, поскольку мы могли изменять или добавлять нижестоящих потребителей, не требуя изменений в приложениях-отправителях.