---
tags:
- Technology
- Difficulty/Base
---
----
## Что такое гарантированная доставка сообщений И какими механизмами ее можно обеспечить
----
> [!FAQ]- Ответ
> - Гарантированная доставка сообщений — это критически важное нефункциональное требование в интеграции систем, которое обеспечивает успешное получение и обработку сообщения, отправленного отправителем, получателем, независимо от сбоев сети, простоев компонентов или сбоев системы. С точки зрения бизнес-аналитика, я определяю это на этапе сбора требований как ограничение, необходимое для сохранения целостности данных и непрерывности бизнеса, обычно стремясь к семантике доставки «как минимум один раз» или «точно один раз». В критически важных средах, таких как обработка финансовых транзакций или управление цепочками поставок, это требование предотвращает сценарии потери данных, когда подход «отправил и забыл» привел бы к расхождениям между источником данных и нижестоящими системами отчетности.
> - Для технического обеспечения этого мы используем надежные брокеры сообщений и асинхронные протоколы очередей, такие как те, что используются в JMS, RabbitMQ или Apache Kafka, в сочетании со строгими механизмами подтверждения. Процесс принципиально основан на сохранении данных; когда сообщение попадает в очередь, оно записывается на диск, а не хранится в энергозависимой памяти. Брокер требует положительного подтверждения (ACK) от получателя только после успешного выполнения бизнес-логики. Если получатель выходит из строя во время обработки или истекает время ожидания сети до получения ACK, брокер предполагает сбой и повторно отправляет сообщение.
> - Кроме того, надежная реализация гарантированной доставки требует обработки потенциального дублирования данных, что является распространенным побочным эффектом политик повторных попыток. Как старший бизнес-аналитик, я гарантирую, что всякий раз, когда я указываю доставку «как минимум один раз», я одновременно определяю требования к идемпотентности. Это включает в себя внедрение уникального идентификатора транзакции или ключа идемпотентности в заголовок сообщения. Принимающая система должна быть спроектирована таким образом, чтобы проверять этот ключ по реестру обработанных событий; если ключ уже существует, система просто подтверждает дубликат, не выполняя повторно логику, тем самым обеспечивая согласованность конечного состояния системы независимо от того, сколько раз было передано сообщение.